{% extends 'base.html' %}
{% load crispy_forms_filters %}
{% load static %}

{% block content %}


<div class="row">
  {% include 'Itsidemenu2.html' %}
  <div class="col-12 col-sm-12 col-md-9">
      <br>
      <br>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li id="asset" class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab"
          aria-controls="home" aria-selected="true">Asset Data</button>
      </li>
      <li id="warranty" class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab"
          aria-controls="profile" aria-selected="false">Supplier/Warranty</button>
      </li>
      <li id="config" class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab"
          aria-controls="contact" aria-selected="false">Configuration</button>
      </li>
      <li id="allocation" class="nav-item" role="presentation">
        <button class="nav-link" id="allocation-tab" data-bs-toggle="tab" data-bs-target="#allocationtab" type="button"
          role="tab" aria-controls="allocation" aria-selected="false">Allocation</button>
      </li>
      <li id="id_maintanence" class="nav-item" role="presentation">
        <button class="nav-link" id="maintanence-tab" data-bs-toggle="tab" data-bs-target="#maintanencetab" type="button"
          role="tab" aria-controls="allocation" aria-selected="false">Maintanence History</button>
      </li>
    </ul>
    <div class="card">
      <div class="card-body">
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="container-fluid mt-4">
              <h5>Asset Details</h5>
        
              <table id="sortableTable1" data-toggle="table" data-sortable="true" data-pagination="true"
                class="table table-striped table-bordered">
        
                <tbody>
        
                  <tr>
                    <td> <strong>REF NO</strong></td>
                    <td> {{itassetdetail_obj.id}}</td>
                  </tr>
                  <tr>
                    <td><strong>Brand</strong></td>
                    <td>{{itassetdetail_obj.brand}}</td>
                  </tr>
                  <tr>
                    <td><strong>Category</strong></td>
                    <td>{{itassetdetail_obj.category}}</td>
                  </tr>
                  <tr>
                    <td><strong>Model</strong></td>
                    <td>{{itassetdetail_obj.model}}</td>
                  </tr>
                  <tr>
                    <td><strong> Serial Number</strong></td>
                    <td>{{itassetdetail_obj.serial_number}}</td>
        
                  </tr>
                  <tr>
                    <td><strong>Asset Tag</strong></td>
                    <td>{{itassetdetail_obj.Asset_tag}}</td>
        
                  </tr>
                  <tr>
                    <td><strong>Remarks</strong></td>
                    <td>
                      {{ itassetdetail_obj.asset_remarks }}
                    </td>
                  </tr>
        
                  <tr>
                    <td><strong>Product Status</strong></td>
                    <td>{{itassetdetail_obj.status}}</td>
                  </tr>
                  <tr>
                    <td><strong>Availability</strong></td>
                    <td>{{itassetdetail_obj.allocation_status}}</td>
                  </tr>
                  <tr>
                    <td><strong>Image</strong></td>
                    <td>
                      {% if itassetdetail_obj.image %}
                      <a href="{{ itassetdetail_obj.image.url }}" target="_blank">
                        <img src="{{ itassetdetail_obj.image.url }}" width="60" height="60" alt="Uploaded Image">
                      </a>
                      {% else %}
        
                      <p>No image uploaded</p>
                      {% endif %}
                    </td>
                  </tr>
        
                  <tr>
                    <td><strong>Attachments</strong></td>
                    <td>{% if itassetdetail_obj.file %}
                      <p>Uploaded File: <a href="{{ itassetdetail_obj.file.url }}" target="_blank">{{
                          itassetdetail_obj.file.name
                          }}</a></p>
                      <!-- Add a link to download the file, if needed -->
                      <!--<a href="{{ itassetdetail_obj.file.url }}" download>Download File</a>-->
                      {% else %}
                      <p>No file uploaded</p>
                      {% endif %}
                    </td>
                  </tr>
        
                </tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div class="container-fluid mt-4">
              <h5>Supplier/Warranty details</h5>
          
              <table id="sortableTable2" data-toggle="table" data-sortable="true" data-pagination="true"
                class="table table-striped table-bordered">
          
                <tbody>
          
                  <tr>
                    <td> <strong>Supplier</strong></td>
                    <td> {{itassetdetail_obj.supplier}}</td>
                  </tr>
                  <tr>
                    <td><strong>Warranty Start Date</strong></td>
                    <td>{{itassetdetail_obj.warranty_start_date}}</td>
                  </tr>
                  <tr>
                    <td><strong>Warranty End Date</strong></td>
                    <td>{{itassetdetail_obj.warranty_end_date}}</td>
                  </tr>
                  <tr>
                    <td><strong>Asset Added On</strong></td>
                    <td>{{itassetdetail_obj.created_date}}</td>
                  </tr>
                  <tr>
                    <td><strong>PO Number</strong></td>
                    <td>{{itassetdetail_obj.po_number}}</td>
                  </tr>
          
          
                </tbody>
              </table>
            </div>
          </div>
          <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
            <div class="container-fluid mt-4">
              <h5>Configuration Details</h5>
              <table id="sortableTable3" data-toggle="table" data-sortable="true" data-pagination="true"
                class="table table-striped table-bordered">
          
                <tbody>
          
                  <tr>
                    <td> <strong>Processor</strong></td>
                    <td> {{itassetdetail_obj.processor}}</td>
                  </tr>
                  <tr>
                    <td><strong>Memmory</strong></td>
                    <td>{{itassetdetail_obj.ram}}</td>
                  </tr>
                  <tr>
                    <td><strong>Hard Disk</strong></td>
                    <td>{{itassetdetail_obj.harddisk}}</td>
                  </tr>
                  <tr>
                    <td><strong>Operating System</strong></td>
                    <td>{{itassetdetail_obj.operating_system}}</td>
                  </tr>
          
          
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="tab-pane fade" id="allocationtab" role="tabpanel" aria-labelledby="allocation-tab">
            <div class="container-fluid mt-4">
              <h5>Allocation Details</h5>
          
              {% if itassetdetail_obj.allocation_status.status == 'In Use' and itassetdetail_obj.status.status == 'Active' %}
              <table id="sortableTable4" data-toggle="table" data-sortable="true" data-pagination="true"
                class="table table-striped table-bordered">
          
                <tbody>
          
                  <tr>
                    <td> <strong>Employee ID</strong></td>
                    <td> {{allocationdetails.user}}</td>
                  </tr>
                  <tr>
                    <td><strong>Employee Name</strong></td>
                    <td>{{allocationdetails.user.first_name}} {{allocationdetails.user.last_name}}</td>
                  </tr>
                  <tr>
                    <td><strong>Mobile No</strong></td>
                    <td>{{allocationdetails.user.phone_number}}</td>
                  </tr>
                  <tr>
                    <td><strong>Email ID</strong></td>
                    <td>{{allocationdetails.user.email}}</td>
                  </tr>
                  <tr>
                    <td><strong>Station</strong></td>
                    <td>{{allocationdetails.user.station_name}}</td>
                  </tr>
                  <tr>
                    <td><strong>Date of Allocation("Y-M-D")</strong></td>
                    <td>{{allocationdetails.allocation_date|date:"Y-m-d"}} </td>
                  </tr>
          
          
                </tbody>
              </table>
              <a href="{% url 'itassets:test_deallocate_asset' itassetdetail_obj.id %}" class="btn btn-primary">Check Out</a>
              <a href="{% url 'itassets:htmltopdf' itassetdetail_obj.id  %}" class="btn btn-primary">Generate PDF</a>
              {% elif itassetdetail_obj.allocation_status.status == 'Ex Stock' and itassetdetail_obj.status.status == 'Active' %}
              <p>This product is ready to allocate.</p>
              <p>Product Status: {{ itassetdetail_obj.status.status }}</p>
              <p>Allocation Status : {{ itassetdetail_obj.allocation_status.status }} </p>
          
              <a href="{% url 'itassets:Allocate_Asset_IT' itassetdetail_obj.id %}" class="btn btn-primary">Check IN</a>
              {% else %}
              <p>This product is currently not available.</p>
              <p>Product Status: {{ itassetdetail_obj.status.status }}</p>
              <p> {{ itassetdetail_obj.allocation_status.status }} </p>
              {% endif %}
          
          
          
          
            </div>
          </div>
          <div class="tab-pane fade" id="maintanencetab" role="tabpanel" aria-labelledby="maintanence-tab">
            <div class="container-fluid mt-4">
          
          
              <a class="btn btn-primary btn-block col-lg-1 col-md-1 col-12"
                href="{% url 'itassets:create_main_request_id' itassetdetail_obj.id %}">ADD Maintanence</a>
              <br>
              <br>
              <h5>Maintanence Details</h5>
          
              <table id="sortableTable4" data-toggle="table" data-sortable="true" data-pagination="true"
                class="table table-striped table-bordered">
          
          
                <thead>
                  <tr>
                    <th data-field="MR Ref No" data-sortable="true">MR Ref No</th>
                    <th data-field="MR Ref No" data-sortable="true">Created By</th>
                    <th data-field="Serial Number" data-sortable="true">Serial Number</th>
                    <th data-field="Category" data-sortable="true">Category</th>
                    <th data-field="Created Date" data-sortable="true">Created Date</th>
          
                    <th data-field="Vendor" data-sortable="true">Vendor</th>
                    <th data-field="Payment Mode" data-sortable="true">Payment Mode</th>
          
                    <th data-field="Under Warranty" data-sortable="true">Under Warranty</th>
                    <th data-field="Amount" data-sortable="true">Amount</th>
                    <th data-field="Product Status" data-sortable="true">Product Status</th>
                    <th data-field="View" data-sortable="true">Attachments</th>
                    <th data-field="View" data-sortable="true">EDIT</th>
          
                  </tr>
          
                </thead>
          
                <tbody>
                  {% for request in itassetdetail_obj.maintenance_requests.all %}
                  <tr>
                    <td> {{request.id}}</td>
                    <td> 
                      {% if request.Created_By %}
                         {{ request.Created_By }}
                      {% else %}
                      NA
                      {% endif %}
                      
                      </td>
                    <td> {{request.it_product.serial_number}}</td>
                    <td> {{request.it_product.category}}</td>
                    <td> {{request.request_date}}</td>
                    <td> {{request.Vendor}}</td>
                    <td> {% if request.Payment_Mode %}
                      {% if request.Payment_Mode == "1"%}
                      PO
                      {% elif request.Payment_Mode == "2"%}
                      Cash
          
                      {%else %}
                      NA
                      {% endif %}
                      {% endif %}
                    </td>
                    <td> {% if request.is_under_warranty is True %}
                      Under Warranty
                      {% elif request.is_under_warranty is False %}
                      Not Under Warranty
                      {% else %}
                      NA
                      {% endif %}
                    </td>
                    <td> {{request.amount}}</td>
                    <td> {% if request.status == "1" %}
                      Pending
                      {% elif request.status == "2" %}
                      Submitted to Vendor
                      {% elif request.status == "3" %}
                      Completed
                      {% else %}
                      Unknown Status
                      {% endif %}
                    </td>
                    <td>{% if request.file %}
                      <a href="{{ request.file.url }}" target="_blank">View Attachment</a>
                      {% else %}
                      No attachments
                      {% endif %}
                    </td>
          
                    <td><a href="{% url 'itassets:Edit_maintenance_request_id' request.id %}" class="btn btn-primary">EDIT </a>
                    </td>
                  </tr>
          
          
                  {% empty %}
                  <tr>
                    <td colspan="2">No maintenance requests found.</td>
                  </tr>
                  {% endfor %}
          
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div> 
    


  </div>
</div>
 
  

<script>
  $(document).ready(function() {
    
    {% comment %}   $('#sortableTable').bootstrapTable(); {% endcomment %}
  });
</script>

  {% endblock content%}